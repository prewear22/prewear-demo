<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PreWear Final Demo (Detailed Report & GIF)</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>

    <style>
        /* ê¸°ë³¸ ì„¤ì • */
        body { margin: 0; font-family: 'Pretendard', sans-serif; background: #f8f9fa; color: #333; }
        * { box-sizing: border-box; }
        
        header { background: white; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; }
        .logo { font-weight: 800; font-size: 22px; letter-spacing: -1px; }
        nav span { margin-right: 25px; font-weight: 600; font-size: 15px; cursor: pointer; }
        
        .product-container { display: flex; max-width: 1200px; margin: 50px auto; background: white; padding: 0; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); overflow: hidden; }
        .product-image-area { flex: 1; position: relative; background: #f0f0f0; min-height: 700px; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        #main-image { width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s; }
        
        /* ë¼ë²¨ */
        #fit-label { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); color: white; padding: 12px 25px; border-radius: 30px; font-weight: bold; font-size: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); animation: popUp 0.3s; z-index: 5; }
        #fit-label.critical { background: #7f1d1d; } #fit-label.warning { background: #ef4444; } #fit-label.success { background: #10b981; } #fit-label.repaired { background: #7c3aed; }
        @keyframes popUp { from { transform: translate(-50%, 30px); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }

        /* ìŠ¤ìº” íš¨ê³¼ */
        #scan-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.75); z-index: 10; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .scan-bar { width: 100%; height: 4px; background: #00ffcc; box-shadow: 0 0 20px #00ffcc; animation: scanMove 1.5s infinite ease-in-out; position: absolute; top: 0; }
        @keyframes scanMove { 0% { top: 0%; opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { top: 100%; opacity: 0; } }

        /* ìš°ì¸¡ ì •ë³´ */
        .product-info { flex: 0.8; padding: 50px; display: flex; flex-direction: column; justify-content: center; }
        .brand { font-size: 14px; color: #666; font-weight: 600; margin-bottom: 8px; }
        .product-name { font-size: 28px; margin: 0 0 20px 0; letter-spacing: -0.5px; line-height: 1.3; font-weight: 800; }
        .price { font-size: 24px; font-weight: 700; margin-bottom: 40px; }
        .size-select { display: flex; gap: 10px; margin-bottom: 30px; }
        .size-btn { width: 60px; height: 60px; border: 1px solid #ddd; background: white; cursor: pointer; border-radius: 8px; font-size: 16px; transition: 0.2s; font-weight: 500; }
        .size-btn.selected { border: 2px solid #111; font-weight: 800; background: #fff; color: #000; }
        .prewear-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #2563eb, #1d4ed8); color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.2s; display: flex; justify-content: center; align-items: center; gap: 8px; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3); }
        .actions { display: flex; gap: 10px; margin-top: 20px; }
        .actions button { flex: 1; padding: 18px; font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 6px; border:none; }
        .cart-btn { background: #eee; color: #333; } .buy-btn { background: #111; color: white; }

        /* ëª¨ë‹¬ ê³µí†µ */
        .hidden { display: none !important; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content.wide-modal { background: white; width: 1200px; height: 95vh; border-radius: 20px; overflow: hidden; display: flex; flex-direction: column; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { background: #111; color: white; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .close-btn { cursor: pointer; font-size: 30px; opacity: 0.8; color: white; background: none; border: none;}
        .modal-layout { display: flex; flex: 1; overflow: hidden; }
        
        /* ì•„ë°”íƒ€ ë·° (ì¢Œìš°) */
        .avatar-view { flex: 1.2; background: #18181b; padding: 20px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .dual-avatar-container { display: flex; gap: 20px; width: 100%; height: 100%; justify-content: center; }
        .single-avatar-box { flex: 1; display: flex; flex-direction: column; align-items: center; position: relative; }
        .avatar-label { color: #aaa; font-size: 13px; margin-bottom: 10px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .avatar-img { width: 100%; height: 100%; object-fit: contain; border-radius: 12px; background: rgba(255,255,255,0.05); }
        
        /* â˜… ë¦¬í¬íŠ¸ ë·° (ìƒì„¸ ìŠ¤íƒ€ì¼ ë³µêµ¬) â˜… */
        .report-view { flex: 0.8; padding: 40px; overflow-y: auto; background: #fff; display: flex; flex-direction: column; gap: 25px; }
        .section h4 { margin: 0 0 15px 0; font-size: 16px; color: #111; font-weight: 800; border-left: 5px solid #111; padding-left: 12px; }
        
        .score-box { display: flex; align-items: center; gap: 15px; margin-bottom: 10px; }
        .score-num { font-size: 36px; font-weight: 900; letter-spacing: -1px; }
        .score-badge { padding: 5px 12px; border-radius: 6px; font-size: 14px; font-weight: bold; }
        .score-box.critical .score-num { color: #991b1b; } .score-box.critical .score-badge { background: #7f1d1d; color: #fff; }
        .score-box.warning .score-num { color: #ef4444; } .score-box.warning .score-badge { background: #fee2e2; color: #991b1b; }
        .score-box.success .score-num { color: #059669; } .score-box.success .score-badge { background: #d1fae5; color: #065f46; }
        
        .ai-comment { font-size: 14px; color: #444; background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 0; line-height: 1.6; border: 1px solid #e9ecef; }
        
        .detail-list li { padding: 15px; border: 1px solid #eee; margin-bottom: 10px; border-radius: 8px; list-style: none; display: flex; flex-direction: column; gap: 5px; }
        .detail-list li.critical { border-left: 5px solid #991b1b; background: #fef2f2; }
        .detail-list li.red { border-left: 5px solid #ef4444; background: #fff5f5; }
        .detail-list li.green { border-left: 5px solid #10b981; background: #f0fdf4; }
        .part-name { font-weight: bold; font-size: 15px; }
        .part-val { font-size: 13px; color: #666; font-family: monospace; background: rgba(0,0,0,0.05); padding: 2px 6px; border-radius: 4px; display: inline-block; width: fit-content; }
        .part-desc { font-size: 13px; color: #555; }

        .guide-box, .critical-box, .warning-box, .safe-box { padding: 15px; border-radius: 8px; font-size: 14px; line-height: 1.6; }
        .guide-box { background: #f8f9fa; border: 1px solid #e9ecef; }
        .critical-box { background: #450a0a; border: 1px solid #7f1d1d; color: #fecaca; }
        .warning-box { background: #fff5f5; border: 1px solid #feb2b2; color: #c53030; }
        .safe-box { background: #ecfdf5; border: 1px solid #a7f3d0; color: #065f46; }
        
        .ai-recommendation { margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ccc; font-weight: bold; color: #2563eb; }

        .repair-btn, .durability-btn { width: 100%; padding: 15px; color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 15px; margin-top: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s; }
        .repair-btn { background: #7c3aed; } .repair-btn:hover { background: #6d28d9; }
        .durability-btn { background: #f59e0b; } .durability-btn:hover { background: #d97706; }

        .report-size-control { margin-top: 20px; display: flex; gap: 10px; background: #f1f5f9; padding: 10px; border-radius: 12px; }
        .rs-btn { flex: 1; padding: 15px; border: none; background: white; border-radius: 8px; font-weight: bold; font-size: 15px; cursor: pointer; transition: 0.2s; color: #64748b; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .rs-btn:hover { background: #e2e8f0; color: #333; }
        .rs-btn.active { background: #111; color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        .view3d-popup { width: 900px; height: 850px; background: #222; border-radius: 12px; overflow: hidden; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: space-between; box-shadow: 0 30px 60px rgba(0,0,0,0.5); }
        model-viewer { width: 100%; flex: 1; background-color: #222; }
        .view3d-overlay { position: relative; bottom: auto; margin-bottom: 30px; color: rgba(255,255,255,0.6); font-size: 14px; pointer-events: none; background: transparent; padding: 0; }
        .close-3d-btn { position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; background: none; border: none; cursor: pointer; z-index: 10; }
        .view3d-controls { position: relative; bottom: auto; margin: 20px 0; display: flex; gap: 15px; z-index: 10; }
        .control-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 12px 30px; border-radius: 30px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .control-btn:hover { background: rgba(255,255,255,0.3); }
        .control-btn.active { background: #2563eb; border-color: #2563eb; }
        #btn-3d-repair { background: #7c3aed; border-color: #7c3aed; display: none; } 

        .durability-popup { width: 1100px; height: 95vh; background: white; padding: 40px; border-radius: 16px; text-align: center; position: relative; overflow-y: auto; display: flex; flex-direction: column; }
        .durability-options { display: flex; gap: 20px; margin-top: 30px; justify-content: center; flex: 1; align-items: center; }
        .action-btn { width: 200px; height: 200px; border: 2px solid #eee; background: white; border-radius: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px; font-size: 18px; font-weight: bold; transition: 0.2s; }
        .action-btn:hover { background: #f8f9fa; transform: translateY(-5px); border-color: #333; }
        .action-icon { font-size: 50px; }

        .sim-split-container { display: none; margin-top: 20px; width: 100%; height: 600px; gap: 20px; }
        .sim-video-box { flex: 1; background: #000; border-radius: 12px; overflow: hidden; position: relative; }
        .sim-video-box img { width: 100%; height: 100%; object-fit: cover; }
        .sim-label { position: absolute; top: 15px; left: 15px; color: white; background: rgba(0,0,0,0.6); padding: 8px 15px; border-radius: 6px; font-size: 14px; font-weight: bold; z-index: 5; }
        
        .comparison-view { display: flex; gap: 30px; margin-top: 30px; width: 100%; height: auto; min-height: 600px; }
        .comp-box { flex: 1; display: flex; flex-direction: column; background: #f8f9fa; border-radius: 12px; overflow: hidden; border: 1px solid #ddd; }
        .comp-label { background: #333; color: white; padding: 15px; font-size: 16px; font-weight: bold; flex-shrink: 0; }
        .comp-img { flex: 1; width: 100%; height: 100%; object-fit: contain; background: #fff; }
        
        .clickable-box { cursor: pointer; transition: 0.2s; border: 2px solid transparent; border-radius: 8px; position: relative; }
        .clickable-box:hover { border-color: #2563eb; transform: scale(1.01); }
        .zoom-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 40px; color: white; opacity: 0; transition: 0.2s; text-shadow: 0 2px 10px rgba(0,0,0,0.5); pointer-events: none; }
        .clickable-box:hover .zoom-icon { opacity: 1; }
    </style>
</head>
<body>

    <header>
        <div class="logo">M-SHOP</div>
        <nav><span>NEW</span><span>BEST</span><span>MEN</span></nav>
        <div class="user-icon">MY</div>
    </header>

    <main class="product-container">
        <div class="product-image-area">
            <img src="" id="main-image" alt="ìƒí’ˆì´ë¯¸ì§€">
            <div id="scan-overlay" class="hidden"><div class="scan-bar"></div></div>
            <div id="fit-label" class="hidden"></div>
        </div>

        <div class="product-info">
            <h2 class="brand">PreWear Signature</h2>
            <h1 class="product-name">ì™€ì´ë“œ í• ë°´ë”© ìŠ¬ë™ìŠ¤ (Black)</h1>
            <p class="price">59,000ì›</p>
            <div class="option-group">
                <p class="option-title">SIZE</p>
                <div class="size-select">
                    <button class="size-btn" data-size="S">S</button>
                    <button class="size-btn selected" data-size="M">M</button>
                    <button class="size-btn" data-size="L">L</button>
                </div>
            </div>
            <div class="prewear-section">
                <button id="prewear-btn" class="prewear-btn"><span>âœ¨</span> PreWearë¡œ ì…ì–´ë³´ê¸°</button>
                <p style="text-align:center; font-size:13px; color:#666; margin-top:12px;">ë‚´ 3D ì•„ë°”íƒ€ë¡œ í•ê³¼ ìˆ˜ëª…ì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤.</p>
            </div>
            <div class="actions">
                <button class="cart-btn">ì¥ë°”êµ¬ë‹ˆ</button>
                <button class="buy-btn">êµ¬ë§¤í•˜ê¸°</button>
            </div>
        </div>
    </main>

    <div id="result-modal" class="modal hidden">
        <div class="modal-content wide-modal">
            <div class="modal-header">
                <h3>PreWear 3D FIT REPORTâ„¢</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-layout">
                <div class="avatar-view">
                    <div class="dual-avatar-container">
                        <div class="single-avatar-box clickable-box" id="click-3d-trigger">
                            <span class="avatar-label">Real Fit (Click to 3D View)</span>
                            <img src="" id="avatar-real-img" class="avatar-img" alt="ì‹¤ì‚¬ ì•„ë°”íƒ€">
                            <div class="zoom-icon">ğŸ”„ 3D</div>
                        </div>
                        <div class="single-avatar-box">
                            <span class="avatar-label">Strain Map (Analysis)</span>
                            <img src="" id="avatar-heat-img" class="avatar-img" alt="íˆíŠ¸ë§µ ì•„ë°”íƒ€">
                        </div>
                    </div>
                </div>

                <div class="report-view">
                    <div class="section">
                        <h4>[1. í• ìŠ¤ì½”ì–´]</h4>
                        <div class="score-box" id="score-box"><span class="score-num" id="score-num">--</span><span class="score-badge" id="score-badge">--</span></div>
                        <p class="ai-comment" id="score-comment">--</p>
                    </div>
                    <div class="section">
                        <h4>[2. ë¶€ìœ„ë³„ ë¶„ì„]</h4>
                        <ul class="detail-list" id="detail-list"></ul>
                    </div>
                    <div class="section">
                        <h4>[3. ìˆ˜ì„  ê°€ì´ë“œ]</h4>
                        <div id="guide-box"></div>
                        <button id="repair-preview-btn" class="repair-btn" style="display:none;"><span>âœ‚ï¸</span> 2.5cm ìˆ˜ì„  í›„ í• ë¯¸ë¦¬ë³´ê¸°</button>
                    </div>
                    <div class="section">
                        <h4>[4. ë‚´êµ¬ë„ ì˜ˆì¸¡]</h4>
                        <p id="durability-count" style="font-weight:bold; margin-bottom:5px;">--</p>
                        <div id="durability-box"></div>
                        <button id="durability-test-btn" class="durability-btn"><span>âš¡</span> ë‚´êµ¬ë„ ì‹œë®¬ë ˆì´ì…˜ (ë™ì˜ìƒ)</button>
                    </div>
                    
                    <div class="report-size-control">
                        <button class="rs-btn" id="rs-btn-s" onclick="renderS()">Size S</button>
                        <button class="rs-btn" id="rs-btn-m" onclick="renderM()">Size M</button>
                        <button class="rs-btn" id="rs-btn-l" onclick="renderL()">Size L</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="view3d-modal" class="modal hidden" style="z-index:3000;">
        <div class="view3d-popup">
            <button class="close-3d-btn" onclick="closeView3D()">&times;</button>
            <model-viewer id="viewer-3d" src="" camera-controls auto-rotate shadow-intensity="1" style="width: 100%; height: 100%;"></model-viewer>
            <div class="view3d-controls">
                <button class="control-btn" onclick="switchModel('S')">Size S</button>
                <button class="control-btn" onclick="switchModel('M')">Size M</button>
                <button class="control-btn" onclick="switchModel('L')">Size L</button>
                <button class="control-btn" id="btn-3d-repair" onclick="switchModel('Repair')">L (ìˆ˜ì„ ë¨)</button>
            </div>
            <div class="view3d-overlay">ğŸ–±ï¸ ë§ˆìš°ìŠ¤ë¡œ ëŒë ¤ì„œ 360ë„ í™•ì¸</div>
        </div>
    </div>

    <div id="durability-modal" class="modal hidden" style="z-index:2000;">
        <div class="durability-popup">
            <button onclick="closeDuraModal()" style="position:absolute; top:20px; right:20px; border:none; background:none; font-size:30px; cursor:pointer;">&times;</button>
            <h3 id="dura-title" style="font-size:24px; margin-bottom:10px;">ë‚´êµ¬ë„ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸</h3>
            <p id="dura-desc" style="color:#666; font-size:16px;">ì‹¤ì œ ë™ì‘ í™˜ê²½ì—ì„œ ì›ë‹¨ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.</p>
            
            <div id="dura-options" class="durability-options">
                <button class="action-btn" onclick="runSim('walk')"><span class="action-icon">ğŸš¶</span><span>ê±·ê¸° (10km)</span></button>
                <button class="action-btn" onclick="runSim('run')"><span class="action-icon">ğŸƒ</span><span>ë‹¬ë¦¬ê¸° (5km)</span></button>
                <button class="action-btn" onclick="runSim('wash')"><span class="action-icon">ğŸ§º</span><span>ì„¸íƒ (10íšŒ)</span></button>
            </div>

            <div id="dura-sim-area" class="sim-split-container">
                <div class="sim-video-box">
                    <span class="sim-label">Real Simulation</span>
                    <img id="sim-gif-left" src="" alt="Simulation">
                </div>
                <div class="sim-video-box">
                    <span class="sim-label">Heatmap Analysis</span>
                    <img id="sim-gif-right" src="" alt="Simulation Heatmap">
                </div>
            </div>

            <div id="dura-result-area" style="display:none; margin-top:20px; height:100%; display:flex; flex-direction:column;">
                <p style="color:#d32f2f; font-weight:bold; margin-bottom:10px; font-size:20px;">âš ï¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼: ì›ë‹¨ ë³€í˜• ê°ì§€ë¨</p>
                <div class="comparison-view">
                    <div class="comp-box"><div class="comp-label">Before</div>
                        <img id="comp-img-before" class="comp-img" src="">
                    </div>
                    <div class="comp-box"><div class="comp-label">After (ì†ìƒ í›„)</div>
                        <img id="comp-img-after" class="comp-img" src="">
                    </div>
                </div>
                <button onclick="closeDuraModal()" style="margin-top:20px; padding:15px 40px; background:#333; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold; font-size:16px; align-self:center;">í™•ì¸ ì™„ë£Œ</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // ============================================================
            // [íŒŒì¼ëª… ì„¤ì •] â˜… ëŒ€ì†Œë¬¸ì í™•ì¸ í•„ìˆ˜ (.jpg / .JPG) â˜…
            // ============================================================
            const IMG_MAIN = "main.jpg"; 
            
            const IMG_S_REAL = "avatar_s_real.jpg"; const IMG_S_HEAT = "avatar_s_heat.jpg";
            const IMG_M_REAL = "avatar_m_real.jpg"; const IMG_M_HEAT = "avatar_m_heat.jpg";
            
            // ê¸°ì¡´ í´ë”ì— ìˆë˜ L íˆíŠ¸ë§µ íŒŒì¼ëª… í™•ì¸ (ëŒ€ë¬¸ì .JPG)
            const IMG_L_REAL = "avatar_l_real.jpg"; const IMG_L_HEAT = "avatar_l_heat.JPG"; 
            
            const IMG_REPAIR_REAL = "avatar_repair_real.jpg"; const IMG_REPAIR_HEAT = "avatar_repair_heat.jpg"; 
            const IMG_DAMAGE_KNEE = "damage_knee.jpg"; const IMG_DAMAGE_SHRUNK = "damage_shrunk.jpg"; 
            const IMG_BEFORE_SIM = "before_sim.jpg";

            // â˜… GIF íŒŒì¼ëª… â˜…
            const GIF_WALK = "walk.gif"; 
            const GIF_RUN = "run.gif";   
            const GIF_WASH = "wash.gif"; 

            const GIF_WALK_HEAT = "walk_heat.gif"; 
            const GIF_RUN_HEAT = "run_heat.gif";   
            const GIF_WASH_HEAT = "wash_heat.gif"; 

            const MODEL_S = "model_s.glb"; 
            const MODEL_M = "model_m.glb"; 
            const MODEL_L = "model_l.glb"; 
            const MODEL_REPAIR = "model_repair.glb"; // ìˆ˜ì„ ëœ ëª¨ë¸
            // ============================================================

            const mainImage = document.getElementById('main-image');
            const realImg = document.getElementById('avatar-real-img');
            const heatImg = document.getElementById('avatar-heat-img');
            const compBefore = document.getElementById('comp-img-before');
            const compAfter = document.getElementById('comp-img-after');
            const modal = document.getElementById('result-modal');
            const duraModal = document.getElementById('durability-modal');
            const view3dModal = document.getElementById('view3d-modal');
            const sizeBtns = document.querySelectorAll('.size-btn');
            const viewer3d = document.getElementById('viewer-3d');
            
            let currentSize = 'M';
            let isRepaired = false; // ìˆ˜ì„  ì—¬ë¶€ ìƒíƒœ

            mainImage.src = IMG_MAIN;

            // ë©”ì¸ ì‚¬ì´ì¦ˆ ì„ íƒ
            sizeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    sizeBtns.forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    currentSize = btn.dataset.size;
                    isRepaired = false;
                });
            });

            // ë¶„ì„ ì‹œì‘
            document.getElementById('prewear-btn').addEventListener('click', () => {
                document.getElementById('scan-overlay').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('scan-overlay').classList.add('hidden');
                    if(currentSize === 'S') renderS();
                    else if(currentSize === 'M') renderM();
                    else renderL();
                    modal.classList.remove('hidden');
                }, 1500);
            });

            // ìˆ˜ì„  ë¯¸ë¦¬ë³´ê¸° (Lì‚¬ì´ì¦ˆ ì „ìš©)
            document.getElementById('repair-preview-btn').addEventListener('click', () => {
                realImg.src = IMG_REPAIR_REAL;
                heatImg.src = IMG_REPAIR_HEAT;
                isRepaired = true;
                
                // ìˆ˜ì„  í›„ ì™„ë²½í•´ì§„ ìƒíƒœë¡œ ì—…ë°ì´íŠ¸
                document.querySelector('.score-box').className = "score-box success";
                document.getElementById('score-num').textContent = "98ì "; 
                document.getElementById('score-badge').textContent = "ì™„ë²½ (Perfect)";
                document.getElementById('score-comment').textContent = `"ìˆ˜ì„ ì´ ì ìš©ë˜ì–´ ê¸°ì¥ê³¼ í•ì´ ëª¨ë‘ ì™„ë²½í•©ë‹ˆë‹¤. ë§ì¶¤ì˜· ê°™ì€ ì°©ìš©ê°ì„ ëŠë‚„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."`;
                document.getElementById('guide-box').innerHTML = "<p>âœ… <strong>ìˆ˜ì„  ì ìš© ì™„ë£Œ:</strong> ê¸°ì¥ 3cm ìˆ˜ì„ ì´ ê°€ìƒìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.</p>";

                const btn = document.getElementById('repair-preview-btn');
                btn.innerHTML = "ğŸ›’ ìˆ˜ì„  ì˜µì…˜ ë‹´ê¸° ì™„ë£Œ";
                btn.style.background = "#333";
                alert("ìˆ˜ì„ ëœ í•ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. 3D ë·°ì–´ì—ì„œ í™•ì¸í•˜ì„¸ìš”!");
            });

            // 3D ë·°ì–´ ì˜¤í”ˆ
            document.getElementById('click-3d-trigger').addEventListener('click', () => {
                // ì´ˆê¸° ëª¨ë¸ ë¡œë“œ
                if(isRepaired && currentSize === 'L') {
                    viewer3d.src = MODEL_REPAIR;
                    update3DButtons('Repair');
                } else if(currentSize === 'S') {
                    viewer3d.src = MODEL_S;
                    update3DButtons('S');
                } else if(currentSize === 'M') {
                    viewer3d.src = MODEL_M;
                    update3DButtons('M');
                } else {
                    viewer3d.src = MODEL_L;
                    update3DButtons('L');
                }
                
                // ìˆ˜ì„  ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€ ê²°ì •
                if(isRepaired) {
                    document.getElementById('btn-3d-repair').style.display = 'inline-block';
                } else {
                    document.getElementById('btn-3d-repair').style.display = 'none';
                }

                view3dModal.classList.remove('hidden');
            });

            // 3D ë·°ì–´ ë‚´ ëª¨ë¸ ë³€ê²½
            window.switchModel = function(size) {
                if(size === 'S') viewer3d.src = MODEL_S;
                if(size === 'M') viewer3d.src = MODEL_M;
                if(size === 'L') viewer3d.src = MODEL_L;
                if(size === 'Repair') viewer3d.src = MODEL_REPAIR;
                update3DButtons(size);
            };

            function update3DButtons(activeSize) {
                document.querySelectorAll('.control-btn').forEach(btn => {
                    // ë²„íŠ¼ í…ìŠ¤íŠ¸ì— ì‚¬ì´ì¦ˆê°€ í¬í•¨ë˜ì–´ ìˆê±°ë‚˜, Repairì¸ ê²½ìš° ë§¤ì¹­
                    if(btn.textContent.includes(activeSize) || (activeSize === 'Repair' && btn.id === 'btn-3d-repair')) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }

            window.closeView3D = function() {
                view3dModal.classList.add('hidden');
            };

            document.getElementById('durability-test-btn').addEventListener('click', () => {
                document.getElementById('dura-options').style.display = 'flex';
                document.getElementById('dura-sim-area').style.display = 'none';
                document.getElementById('dura-result-area').style.display = 'none';
                duraModal.classList.remove('hidden');
            });

            window.runSim = function(type) {
                document.getElementById('dura-options').style.display = 'none';
                document.getElementById('dura-sim-area').style.display = 'flex';
                document.getElementById('dura-result-area').style.display = 'none';
                
                const gifLeft = document.getElementById('sim-gif-left');
                const gifRight = document.getElementById('sim-gif-right');
                
                let gifSrcLeft = GIF_WALK;
                let gifSrcRight = GIF_WALK_HEAT; 

                if(type === 'run') {
                    gifSrcLeft = GIF_RUN;
                    gifSrcRight = GIF_RUN_HEAT;
                }
                if(type === 'wash') {
                    gifSrcLeft = GIF_WASH;
                    gifSrcRight = GIF_WASH_HEAT;
                }

                gifLeft.src = gifSrcLeft;
                gifRight.src = gifSrcRight;

                setTimeout(() => {
                    document.getElementById('dura-sim-area').style.display = 'none';
                    document.getElementById('dura-result-area').style.display = 'flex';
                    
                    compBefore.src = IMG_BEFORE_SIM; 
                    if(type === 'wash') compAfter.src = IMG_DAMAGE_SHRUNK;
                    else compAfter.src = IMG_DAMAGE_KNEE;
                }, 4000);
            };

            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', () => modal.classList.add('hidden'));
            });
            window.closeDuraModal = function() { 
                duraModal.classList.add('hidden'); 
            };

            // â˜… ë¦¬í¬íŠ¸ ë Œë”ë§ (í…ìŠ¤íŠ¸ ìƒì„¸ ë³µêµ¬ & ìˆ˜ì„  ë¡œì§ ë³€ê²½) â˜…
            window.renderS = function() {
                realImg.src = IMG_S_REAL; heatImg.src = IMG_S_HEAT;
                currentSize = 'S'; isRepaired = false; // ì´ˆê¸°í™”
                updateReportButtons('S');

                document.querySelector('.score-box').className = "score-box critical";
                document.getElementById('score-num').textContent = "45ì "; 
                document.getElementById('score-badge').textContent = "ìœ„í—˜ â›”";
                document.getElementById('score-comment').textContent = `"ì°©ìš©ì´ ë¶ˆê°€ëŠ¥í•  ì •ë„ë¡œ ì‘ìŠµë‹ˆë‹¤. ì–µì§€ë¡œ ì°©ìš© ì‹œ í˜ˆì•¡ìˆœí™˜ ì¥ì•  ë° ì˜ë¥˜ íŒŒì†ì´ ì¦‰ì‹œ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."`;

                document.getElementById('detail-list').innerHTML = `
                    <li class="critical"><span class="part-name">ğŸ›‘ í—ˆë²…ì§€ (Critical)</span><span class="part-val">í”¼ë¶€ ì••ë ¥ 32.5 kPa (í†µì¦ ìœ ë°œ)</span></li>
                    <li class="critical"><span class="part-name">ğŸ›‘ í—ˆë¦¬ (Impossible)</span><span class="part-val">ì ê¹€ ë¶ˆê°€ (-5cm ë¶€ì¡±)</span></li>
                `;
                document.getElementById('guide-box').className = "guide-box";
                document.getElementById('guide-box').innerHTML = `<p>ğŸš« <strong>ìˆ˜ì„  ë¶ˆê°€:</strong> ì‹œì ‘ ì—¬ë¶„ì´ ì „í˜€ ì—†ì–´ ëŠ˜ë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í•œ ì¹˜ìˆ˜ í° ì‚¬ì´ì¦ˆë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.</p>`;
                
                document.getElementById('repair-preview-btn').style.display = 'none';
                
                document.getElementById('durability-count').innerHTML = `ì˜ˆìƒ ì°©ìš© íšŸìˆ˜: <strong>5íšŒ ë¯¸ë§Œ</strong>`;
                document.getElementById('durability-box').className = "critical-box";
                document.getElementById('durability-box').innerHTML = `ğŸš« <strong>ì¦‰ì‹œ íŒŒì† ìœ„í—˜:</strong> "ì°©ìš© ì‹œë„ë§Œìœ¼ë¡œë„ ì—‰ë©ì´ ë´‰ì œì„ ì´ í„°ì§ˆ í™•ë¥  99%ì…ë‹ˆë‹¤."`;
            }

            window.renderM = function() {
                realImg.src = IMG_M_REAL; heatImg.src = IMG_M_HEAT;
                currentSize = 'M'; isRepaired = false; // ì´ˆê¸°í™”
                updateReportButtons('M');

                document.querySelector('.score-box').className = "score-box warning";
                document.getElementById('score-num').textContent = "78ì "; 
                document.getElementById('score-badge').textContent = "ì£¼ì˜ âš ï¸";
                document.getElementById('score-comment').textContent = `"í—ˆë²…ì§€ì™€ ì—‰ë©ì´ê°€ íƒ€ì´íŠ¸í•©ë‹ˆë‹¤. ì¥ì‹œê°„ ì°©ìš© ì‹œ ë¶ˆí¸í•  ìˆ˜ ìˆìœ¼ë©°, ì•‰ì„ ë•Œ ê°•í•œ ì••ë°•ê°ì´ ì˜ˆìƒë©ë‹ˆë‹¤."`;

                document.getElementById('detail-list').innerHTML = `
                    <li class="red"><span class="part-name">ğŸ”´ í—ˆë²…ì§€ (Tight)</span><span class="part-val">í”¼ë¶€ ì••ë ¥ 15.2 kPa</span><p class="part-desc">"ì›ë‹¨ì´ í•œê³„ì¹˜ê¹Œì§€ ëŠ˜ì–´ë‚˜ ìˆìŠµë‹ˆë‹¤."</p></li>
                    <li class="green"><span class="part-name">ğŸŸ¢ í—ˆë¦¬ (Good)</span><span class="part-val">ì—¬ìœ  ê³µê°„ +10mm (ì ë‹¹í•¨)</span></li>
                `;
                document.getElementById('guide-box').className = "guide-box";
                document.getElementById('guide-box').innerHTML = `<p>âš ï¸ <strong>ìˆ˜ì„  ë¹„ê¶Œì¥:</strong> ì‘ì•„ì„œ ëŠ˜ë¦¬ëŠ” ìˆ˜ì„ ì€ ì›ë‹¨ ì†ìƒì„ ì´ˆë˜í•©ë‹ˆë‹¤. L ì‚¬ì´ì¦ˆë¡œ êµí™˜ì„ ì¶”ì²œí•©ë‹ˆë‹¤.</p>`;
                
                document.getElementById('repair-preview-btn').style.display = 'none';
                
                document.getElementById('durability-count').innerHTML = `ì˜ˆìƒ ì°©ìš© íšŸìˆ˜: <strong>ì•½ 45íšŒ</strong>`;
                document.getElementById('durability-box').className = "warning-box";
                document.getElementById('durability-box').innerHTML = `ğŸš« <strong>ì·¨ì•½ì  ê²½ê³ :</strong> "3ê°œì›” ë‚´ ì—‰ë©ì´ ë¶€ë¶„ ë§ˆëª¨ ë° ë¬´ë¦ ëŠ˜ì–´ë‚¨(Bagging) í˜„ìƒ ì˜ˆìƒ."`;
            }
            
            window.renderL = function() {
                realImg.src = IMG_L_REAL; heatImg.src = IMG_L_HEAT;
                currentSize = 'L'; isRepaired = false; // ì´ˆê¸°í™”
                updateReportButtons('L');

                document.querySelector('.score-box').className = "score-box success"; 
                document.getElementById('score-num').textContent = "89ì "; 
                document.getElementById('score-badge').textContent = "ì–‘í˜¸ (ê¸°ì¥ ê¹€)";
                document.getElementById('score-comment').textContent = `"ì „ì²´ì ìœ¼ë¡œ ì—¬ìœ  ìˆê³  í¸ì•ˆí•œ í•ì´ë‚˜, ê¸°ì¥ì´ ì•½ê°„ ê¸¸ì–´ ë°”ë‹¥ì— ëŒë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤."`;

                document.getElementById('detail-list').innerHTML = `
                    <li class="green"><span class="part-name">ğŸŸ¢ ì „ì²´ í• (Comfort)</span><span class="part-val">í”¼ë¶€ ì••ë ¥ 3.5 kPa (ì¾Œì )</span></li>
                    <li class="red"><span class="part-name">ğŸ”´ ê¸°ì¥ (Long)</span><span class="part-val">+3cm (ê¹€)</span></li>
                `;
                document.getElementById('guide-box').className = "guide-box";
                document.getElementById('guide-box').innerHTML = `<p>âœ‚ï¸ <strong>ìˆ˜ì„  ì¶”ì²œ:</strong> ê¸°ì¥ì„ 3cm ì¤„ì´ë©´ ì™„ë²½í•œ í•ì´ ë©ë‹ˆë‹¤.</p><div class="ai-recommendation">ğŸ’¡ <strong>AI ì˜ê²¬:</strong> "ê¸°ì¥ ìˆ˜ì„  í›„ ì°©ìš©ì„ ê°•ë ¥ ê¶Œì¥í•©ë‹ˆë‹¤."</div>`;
                
                document.getElementById('repair-preview-btn').style.display = 'flex';
                document.getElementById('repair-preview-btn').innerHTML = "<span>âœ‚ï¸</span> 3cm ê¸°ì¥ ìˆ˜ì„  ë¯¸ë¦¬ë³´ê¸°";
                document.getElementById('repair-preview-btn').style.background = "#7c3aed";

                document.getElementById('durability-count').innerHTML = `ì˜ˆìƒ ì°©ìš© íšŸìˆ˜: <strong>150íšŒ ì´ìƒ</strong> (Grade S)`;
                document.getElementById('durability-box').className = "safe-box";
                document.getElementById('durability-box').innerHTML = `âœ… <strong>ë‚´êµ¬ë„ ì•ˆì „:</strong> "ì›ë‹¨ì— ë¬´ë¦¬ê°€ ê°€ì§€ ì•ŠëŠ” í•ì…ë‹ˆë‹¤. 1ë…„ ì´ìƒ ë³€í˜• ì—†ì„ ê²ƒìœ¼ë¡œ ì˜ˆì¸¡ë©ë‹ˆë‹¤."`;
            }

            function updateReportButtons(size) {
                document.querySelectorAll('.rs-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById('rs-btn-' + size.toLowerCase()).classList.add('active');
            }
        });
    </script>
</body>
</html>